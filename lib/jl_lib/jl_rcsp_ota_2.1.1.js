const t="JLRCSP";var s,e,r=1;function n(...e){r<=1&&null!=s&&s.logv(t,...e)}function i(...e){r<=3&&null!=s&&s.logi(t,...e)}function a(...e){r<=4&&null!=s&&s.logw(t,...e)}function h(...e){r<=5&&null!=s&&s.loge(t,...e)}function c(t){return Array.prototype.map.call(new Uint8Array(t),(function(t){return("00"+t.toString(16)).slice(-2)})).join("")}function o(t){let s="";for(let e=0;e<t.length;e++){s+=("00"+t[e].toString(16)).slice(-2),e!=t.length-1&&(s+=":")}return s.toUpperCase()}function l(t){return function(t){for(var s=new DataView(t),e=new Uint8Array(t.byteLength),r=0;r<e.length;r++)e[r]=s.getUint8(r);var n="",i=e;for(r=0;r<i.length;r++){var a=i[r].toString(2),h=a.match(/^1+?(?=0)/);if(h&&8==a.length){for(var c=h[0].length,o=i[r].toString(2).slice(7-c),l=1;l<c;l++)try{o+=i[l+r].toString(2).slice(2)}catch(t){}n+=String.fromCharCode(parseInt(o,2)),r+=c-1}else n+=String.fromCharCode(i[r])}return n}(new Uint8Array(t).buffer)}function u(t){let s;s=t<0?-t:t;const e=s.toString(16).toUpperCase();return""===e?"0x00":t<0?"-0x"+e:"0x"+e}class p{}p.DEFAULT_SEND_CMD_TIMEOUT=3e3,p.DEFAULT_PROTOCOL_MTU=530,exports.Connection=void 0,(e=exports.Connection||(exports.Connection={}))[e.CONNECTION_DISCONNECT=0]="CONNECTION_DISCONNECT",e[e.CONNECTION_CONNECTING=1]="CONNECTION_CONNECTING",e[e.CONNECTION_CONNECTED=2]="CONNECTION_CONNECTED";class d{static getErrorDesc1(t){return this.getErrorDesc2(t,"")}static getErrorDesc2(t,s){let e="";switch(t){case d.ERROR_UNKNOWN:e="Unknown error.";break;case d.ERROR_NONE:e="Success";break;case d.ERROR_INVALID_PARAM:e="Invalid parameter.";break;case d.ERROR_DATA_FORMAT:e="Data formatting error.";break;case d.ERROR_NOT_FOUND_RESOURCE:e="No resources found.";break;case d.ERROR_UNKNOWN_DEVICE:e="Unknown device.";break;case d.ERROR_DEVICE_OFFLINE:e="Device went offline.";break;case d.ERROR_IO_EXCEPTION:e="I/O exceptions occur.";break;case d.ERROR_REPEAT_STATUS:e="Repeat state.";break;case d.ERROR_RESPONSE_TIMEOUT:e="Waiting for reply command timed out.";break;case d.ERROR_REPLY_BAD_STATUS:e="Device returned a bad status.";break;case d.ERROR_REPLY_BAD_RESULT:e="Device returned an error result.";break;case d.ERROR_NONE_PARSER:e="There is no associated parser."}return""==e||null==s||0==s.length?e:e+d.SEPARATOR+s}}d.ERROR_UNKNOWN=255,d.ERROR_NONE=0,d.ERROR_INVALID_PARAM=-1,d.ERROR_DATA_FORMAT=-2,d.ERROR_NOT_FOUND_RESOURCE=-3,d.ERROR_UNKNOWN_DEVICE=-32,d.ERROR_DEVICE_OFFLINE=-33,d.ERROR_IO_EXCEPTION=-35,d.ERROR_REPEAT_STATUS=-36,d.ERROR_RESPONSE_TIMEOUT=-64,d.ERROR_REPLY_BAD_STATUS=-65,d.ERROR_REPLY_BAD_RESULT=-66,d.ERROR_NONE_PARSER=-67,d.SEPARATOR="&_&";class f{t(t){if(null==t)return null;let s=this.i();if(null==s||s.getOpCode()!=t.getOpCode())return null;s.setCommand(t.isCommand()),s.setNeedResponse(t.isNeedResponse()),s.setReserve(t.getReserve());const e=t.h();if(null!=e){let r;if(s.o(e),r=t.isCommand()?s.getParam().l(e):null!=s.getResponse()?s.getResponse().l(e):d.ERROR_NONE_PARSER,r>=d.ERROR_NONE)return s}return null}}class w{constructor(){this.u=!1,this.p=!1,this.D=0,this.C=0,this.m=-1}isCommand(){return this.u}setCommand(t){return this.u=t,t||(this.p=!1),this}isNeedResponse(){return this.p}setNeedResponse(t){return this.p=t,this}getReserve(){return this.D}setReserve(t){return this.D=t,this}getOpCode(){return this.C}setOpCode(t){return this.C=t,this}getSn(){return this.m}h(){return this.A}o(t){if(this.A=t,0!=t.byteLength){let s=0;this.u||s++,t.byteLength>s&&(this.m=t[s])}}v(){let t=8,s=0;null!=this.A&&(t+=this.A.byteLength,s=this.A.byteLength);let e=new Uint8Array(t);e[0]=254,e[1]=220,e[2]=186,e[t-1]=239;let r=0;this.u&&(r|=128),this.p&&(r|=64),e[3]=r,e[4]=this.C;let n=this.u?1:2;if(1==this.C&&n++,s<n)return h("RcspPacket: toData error: payload error."),null;if(e[5]=s>>8,e[6]=255&s,null!=this.A){let t=new Uint8Array(this.A);e.set(t,7)}return e}l(t){if(null==t||t.byteLength<=8)return h("RcspPacket: parseData : data is invalid param."),d.ERROR_INVALID_PARAM;for(let s=0;s<w.RCSP_HEAD.length;s++)if(w.RCSP_HEAD[s]!=t[s])return h("RcspPacket: parseData : head error, it is not rcsp data."),d.ERROR_DATA_FORMAT;let s=3,e=(255&t[s+2])<<8|255&t[s+3];if(e<1||e>t.byteLength-8)return h("RcspPacket: parseData : len error, it is not rcsp data."),d.ERROR_DATA_FORMAT;if(t[s+4+e]!=w.RCSP_END)return h("RcspPacket: parseData : end error, it is not rcsp data."),d.ERROR_DATA_FORMAT;const r=t[s];s++,this.u=128==(128&r),this.p=64==(64&r),this.D=63&r,this.C=t[s],s++;const n=(255&t[s])<<8|255&t[s+1];s+=2;const i=new Uint8Array(n);for(let e=s;e<t.length;e++)i[e-s]=t[e];return this.o(i),s+=n,s++,s}}w.RCSP_HEAD=[254,220,186],w.RCSP_END=239;class x extends w{constructor(t,s,e){super(),this.R=null,this.setOpCode(t),this.k=s,this.setResponse(e),this.setCommand(!0)}getParam(){return this.k}getResponse(){return this.R}getSn(){if(-1==super.getSn()){if(this.isCommand())return this.getParam().getSn();if(null!=this.getResponse())return this.getResponse().getSn()}return super.getSn()}setParam(t){this.k=t}setResponse(t){this.R=t,this.setNeedResponse(null!=t)}setSn(t){this.isCommand()?this.getParam().setSn(t):null!=this.getResponse()&&this.getResponse()?.setSn(t)}setStatus(t){null!=this.getResponse()&&this.getResponse()?.setStatus(t)}getStatus(){return null!=this.getResponse()?this.getResponse().getStatus():-1}v(){let t;return this.isCommand()||this.setNeedResponse(!1),t=this.isCommand()?null==this.k?new Uint8Array(0):this.k.v():null==this.R?new Uint8Array(0):this.R.v(),this.o(t),super.v()}}class D{constructor(){this.m=-1}setSn(t){this.m=t}getSn(){return this.m}getData(){return this.U}setData(t){this.U=t}v(){let t=1;null!=this.U&&(t+=this.U.byteLength);let s=new Uint8Array(t);if(null!=this.m?s[0]=this.m:s[0]=0,null!=this.U)for(let t=0;t<this.U.byteLength;t++)s[t+1]=this.U[t];return s}l(t){if(null==t||t.byteLength<1)return d.ERROR_INVALID_PARAM;if(this.m=t[0],t.byteLength>1){let s=new Uint8Array(t.length-1);for(let e=1;e<t.length;e++)s[e-1]=t[e];this.U=s}return 1}}class C{constructor(){this.S=-1,this.m=-1}getStatus(){return this.S}getSn(){return this.m}h(){return this.A}setStatus(t){this.S=t}setSn(t){this.m=t}o(t){this.A=t}v(){let t=2;null!=this.A&&(t+=this.A.byteLength);const s=new Uint8Array(t);if(s[0]=this.S,s[1]=this.m,null!=this.A)for(let t=0;t<this.A.length;t++)s[t+2]=this.A[t];return s}l(t){return t.byteLength<2?d.ERROR_INVALID_PARAM:(this.S=t[0],this.m=t[1],t.byteLength>2&&(this.A=new Uint8Array(t.length-2),this.A.set(t.slice(2))),2)}}C.STATUS_UNKNOWN=255,C.STATUS_SUCCESS=0,C.STATUS_FAILED=1,C.STATUS_UNKNOWN_CMD=2,C.STATUS_BUSY=3,C.STATUS_NONE_RESOURCE=4,C.STATUS_CRC_ERROR=5,C.STATUS_ALL_DATA_CRC_ERROR=6,C.STATUS_INVALID_PARAM=7,C.STATUS_RESPONSE_DATA_OVER_LIMIT=8;class m extends C{constructor(){super(...arguments),this.result=m.RESULT_OK}l(t){let s=super.l(t);return s<d.ERROR_NONE||t.length>=s+1&&(this.result=255&t[s],s++),s}v(){let t=0;const s=super.v(),e=new Uint8Array(s.byteLength+1);return e.set(s,t),t+=s.length,e[t]=this.result,t+=1,e}}m.RESULT_OK=0,m.RESULT_FAIL=1;class y{constructor(t,s){this.device=t,this.type=s}}y.I=0,y.P=1;class g extends y{constructor(t,s,e,r){super(t,y.I),this._=0,this.O=0,this.command=s,this.timeoutMs=e,this.callback=r}}class A extends y{constructor(t,s){super(t,y.P),this.data=s}}class v extends Array{}class R{constructor(t,s,e,r){this.T=3,this.M=!1,this.ioProxy=t,this.listener=r,this.deviceMtuManager=s,this.N=new v,this.V=new k(e),this.H=new Array,this.F=new Array,this.G=new Map}L(){this.M=!0,this.V.q()}J(){this.M=!1,this.N.length>0&&this.N.forEach((t=>{let s=t.callback;if(null!=s){let e=d.ERROR_IO_EXCEPTION;s.onError(t.device,e,d.getErrorDesc1(e))}})),this.G.size>0&&this.G.forEach((t=>{clearTimeout(t)})),this.N.length=0,this.H.length=0,this.F.length=0,this.G.clear()}W(t){if(this.B(t)){if(this.H.push(t),this.H.length>1)return void n("RCSPDataHandler: 放入数据缓冲区，等待发送");const s={complete:()=>{this.X(this.H,s)}};this.X(this.H,s)}}K(t){if(this.B(t)){if(this.F.push(t),this.F.length>1)return void n("RCSPDataHandler: 放入数据缓冲区，等待解析");const s={complete:()=>{this.j(this.F,s)}};this.j(this.F,s)}}destroy(){this.J()}B(t){if(null==t){const t=d.ERROR_INVALID_PARAM;return this.listener.onError(null,t,d.getErrorDesc2(t,"DataInfo is null")),!1}if(!this.Y()){const s=d.ERROR_IO_EXCEPTION;return this.listener.onError(t.device,s,d.getErrorDesc2(s,"The processing thread is not working.")),!1}return!0}Y(){return this.M}X(t,s){const e=t.shift();if(null==e){if(0==t.length)return;return s.fail?.(),void s.complete?.()}if(!this.Z(e))return h("RCSPDataHandler: send data failed. Please check whether the device is connected."),this.$(e,d.ERROR_IO_EXCEPTION,"send data failed."),s.fail?.(),void s.complete?.();{let t=new Date;e.O=t.getMilliseconds()}if(e.command.isNeedResponse()){-1==this.N.indexOf(e)&&this.N.push(e);let t=setTimeout((t=>{const s=t,e=s._;a("RCSPDataHandler: "+s.command+", reSendCount: "+e+", limit: "+this.T);const r=this.N.indexOf(s);if(r>-1&&this.N.splice(r,1),e<this.T)s._=e+1,this.W(s);else{const t="Command["+u(s.command.getOpCode())+"]";this.$(s,d.ERROR_RESPONSE_TIMEOUT,t)}}),e.timeoutMs,e);const s=this.tt(e);this.G.set(s,t)}else this.st(e);s.success?.(),s.complete?.()}Z(t){const s=t.command.v();if(null==s||0==s.byteLength)return n("RCSPDataHandler: sendData : data is null."),!1;if(s.byteLength>this.et(t.device))return h("RCSPDataHandler: sendData : data over limit. RCSP mtu = "+this.et(t.device)),!1;let e=!1;for(let r=0;r<3&&(e=this.ioProxy.sendDataToDevice(t.device,s),!e);r++);return e}j(t,s){const e=t.shift();if(null==e){if(0==t.length)return;return s.fail?.(),void s.complete?.()}const r=this.V.rt(this.nt(e.device),e.data);if(0==r.length)return s.fail?.(),void s.complete?.();r.forEach((t=>{if(t.isCommand()){const s=this.V.t(t);if(null==s){const s=d.ERROR_NONE_PARSER;this.listener.onError(e.device,s,d.getErrorDesc2(s," Command op code = "+u(t.getOpCode())))}else this.listener.onRcspCommand(e.device,s)}else{const s=this.it(this.N,t);if(null==s)n("RCSPDataHandler: MSG_RECEIVE_DATA : no found cacheDataInfo.");else{n("RCSPDataHandler: MSG_RECEIVE_DATA : "+s);const r=this.tt(s),i=this.G.get(r);null!=i&&(clearTimeout(i),this.G.delete(r));const a=s.command;if(null==a.getResponse())n("RCSPDataHandler: MSG_RECEIVE_DATA : no found command response.");else{const r=a.getResponse().l(t.h());if(n("RCSPDataHandler: MSG_RECEIVE_DATA : ret = "+r),r>=d.ERROR_NONE)this.listener.onRcspResponse(e.device,a),this.st(s);else{const e="The response of the command"+u(t.getOpCode())+" parse error. reason : "+r;n("RCSPDataHandler: "+e),this.$(s,d.ERROR_DATA_FORMAT,e)}}}}}))}$(t,s,e){null!=t.callback&&t.callback.onError(t.device,s,d.getErrorDesc2(s,e)),this.listener.onError(t.device,s,d.getErrorDesc1(s))}st(t){null!=t.callback&&t.callback.onCmdResponse(t.device,t.command)}et(t){let s=this.deviceMtuManager.getReceiveMtu(t);return null!=s&&s>0?s:p.DEFAULT_PROTOCOL_MTU}nt(t){let s=this.deviceMtuManager.getSendMtu(t);return null!=s&&s>0?s:p.DEFAULT_PROTOCOL_MTU}tt(t){if(null==t)return Number.MAX_VALUE;return t.command.getOpCode()<<16|t.command.getParam().getSn()}it(t,s){if(0==t.length)return null;let e=null;if(t.forEach((t=>{s.isCommand()||t.command.getOpCode()!=s.getOpCode()||s.getSn()!=t.command.getParam().getSn()||(e=t)})),null!=e){let s=t.indexOf(e);s>-1&&t.splice(s,1)}return e}}class k{constructor(t){this.ht=null,this.ct=0,this.ot=t}lt(){return this.ot}t(t){if(null==t)return null;let s=this.ut(t.getOpCode());return null==s?null:s.t(t)}ut(t){return this.lt().get(t)}q(){this.ct>0&&(this.ct=0)}rt(t,s){if(0==t||null==s||0==s.length)return new Array;const e=new Array,r=this.dt(s),n=r.length;let a=0,c=0;for(;c<n;){if(a=this.ft(r,c,t),-1==a){i("RcspParser: findPacketData : not find head data.");break}const s=(255&r[a+5])<<8|255&r[a+6],n=new Uint8Array(8+s);for(let t=0;t<n.length;t++)n[t]=r[a+t];const o=new w,l=o.l(n);l>d.ERROR_NONE?(e.push(o),c=a+n.length):(h("RcspParser: findPacketData : parse data error.  code = "+l+", skip"),c++)}return e}ft(t,s,e){if(null==t||0==t.byteLength)return-1;const r=t.byteLength;let i=r-s;if(i<=8)return n("RcspParser: findValidRcspHeadIndex : data is not enough. put data in cache."),this.wt(t,s,i),-1;let a=-1;for(let h=s;h<r;h++){if(t[h]!=w.RCSP_HEAD[0])continue;if(i=r-h,i<=8){this.wt(t,h,i);break}let s=!0;for(let e=0;e<w.RCSP_HEAD.length;e++)t[e+h]!=w.RCSP_HEAD[e]&&(s=!1);if(!s)continue;const c=h+w.RCSP_HEAD.length,o=(255&t[c+2])<<8|255&t[c+3];if(o<1||o>e-8){n("RcspParser: findPacketData :: data length["+o+"] over MAX_RECEIVE_MTU["+e+"], cast away"),h=c-1;continue}if(i<o+8){this.wt(t,h,i);break}if(t[c+4+o]==w.RCSP_END){a=h;break}h=c-1}return a}dt(t){if(null==t)return new Uint8Array(0);const s=t.byteLength;let e;if(this.ct>0)e=new Uint8Array(this.ct+s),this.ht&&e.set(this.ht),e.set(t,this.ct),this.ct=0;else{e=new Uint8Array(s);for(let s=0;s<t.length;s++)e[s]=t[s]}return e}wt(t,s,e){if(null!=t&&t.byteLength>0&&s>=0&&e>0&&s+e<=t.byteLength){const r=t.slice(s,s+e);this.ht=r,this.ct=e}}}class U{}let b=class{};b.CMD_UNKNOWN=0,b.CMD_DATA=1,b.CMD_GET_TARGET_FEATURE_MAP=2,b.CMD_GET_TARGET_INFO=3,b.CMD_DISCONNECT_CLASSIC_BLUETOOTH=6,b.CMD_GET_SYS_INFO=7,b.CMD_SET_SYS_INFO=8,b.CMD_SYS_INFO_AUTO_UPDATE=9,b.CMD_SWITCH_DEVICE_REQUEST=11,b.CMD_CUSTOM=240,b.CMD_EXTRA_CUSTOM=255,b.CMD_NOTIFY_DEVICE_APP_INFO=208,b.CMD_SETTINGS_COMMUNICATION_MTU=209,b.CMD_GET_DEV_MD5=212;let S=class{constructor(){this.ot=new Map,this.ot.set(b.CMD_DATA,new I),this.ot.set(b.CMD_SYS_INFO_AUTO_UPDATE,new P),this.ot.set(b.CMD_SETTINGS_COMMUNICATION_MTU,new _),this.ot.set(b.CMD_CUSTOM,new E),this.ot.set(b.CMD_EXTRA_CUSTOM,new O)}lt(){return this.ot}};class I extends f{i(){return new T(new M)}}class P extends f{i(){return new N(new H)}}class _ extends f{i(){return new q(new J)}}class E extends f{i(){return new X(new D)}}class O extends f{i(){return new B(new D)}}class T extends x{constructor(t){super(b.CMD_DATA,t,null)}}class M extends D{v(){let t=0;const s=super.v();let e=this.payload?.byteLength;null==e&&(e=0);const r=new Uint8Array(s.byteLength+1+e);return r.set(s,t),t+=s.length,null!=this.responseOpCode&&(r[t]=this.responseOpCode,t+=1),e>0&&(r.set(this.payload,t),t+=this.payload.length),r}l(t){let s=super.l(t);if(s<d.ERROR_NONE)return s;if(t.length<s+1)return d.ERROR_DATA_FORMAT;if(this.responseOpCode=255&t[s],s++,t.length>s){const e=new Uint8Array(t.length-s);e.set(t.slice(s)),s+=e.length,this.payload=e}return s}}class N extends x{constructor(t){super(b.CMD_SYS_INFO_AUTO_UPDATE,t,null)}}class V{getLen(){let t=0;return null!=this.value&&null!=this.value&&(t=this.value.byteLength+1),t}v(){let t=this.value?.length||0;const s=new Uint8Array(t+2);return s[0]=this.getLen(),s[1]=null==this.type?0:this.type,t>0&&s.set(this.value,2),s}l(t){if(null==t||t.length<2)return d.ERROR_INVALID_PARAM;let s=0;const e=255&t[s];if(s++,e<1||e>t.length-s)return d.ERROR_DATA_FORMAT;if(this.type=255&t[s],s++,e-1>0){const r=new Uint8Array(e-1);r.set(t.slice(s,s+e-1)),s+=r.length,this.value=r}return s}}class H extends D{v(){let t=0;const s=super.v();let e=new Uint8Array(s.byteLength+1);return e.set(s),t+=s.length,e[t]=null==this.function?0:this.function,t++,null!=this.dataList&&this.dataList.forEach((s=>{const r=s.v(),n=e,i=new Uint8Array(n.byteLength+r.byteLength);i.set(n,0),i.set(r,n.byteLength),t+=r.length,e=i})),e}l(t){let s=super.l(t);if(s<d.ERROR_NONE)return s;if(t.length<s+1)return d.ERROR_DATA_FORMAT;this.function=255&t[s],s++;const e=t.length-s;if(e>0){const r=new Uint8Array(e);r.set(t.slice(s)),s+=r.length;let n=0;const i=new Array;for(;n+2<=r.length;){let t=new Uint8Array(r.length-n);t.set(r.slice(n,n+t.length));const s=new V,e=s.l(t);if(e<=0)break;i.push(s),n+=e}this.dataList=i}return s}}class F extends C{l(t){let s=super.l(t);if(s<d.ERROR_NONE)return s;if(t.length<s+1)return d.ERROR_DATA_FORMAT;this.function=255&t[s],s++;const e=t.length-s;if(e>0){const r=new Uint8Array(e);r.set(t.slice(s)),s+=r.length;let n=0;for(this.dataList=new Array;n+2<=r.length;){const t=new Uint8Array(r.length-n);t.set(r.slice(n,n+t.length));const s=new V,e=s.l(t);if(e<=0)break;this.dataList.push(s),n+=e}}return s}}class G extends x{constructor(t){super(b.CMD_GET_TARGET_INFO,t,new Q)}}G.FLAG_MANDATORY_UPGRADE=1;class L extends D{constructor(t,s){super(),this.mask=t,this.platform=s}v(){const t=super.v(),s=new Uint8Array(t.length+5);let e=0;return s.set(t,0),e+=t.length,s[e]=this.mask>>24,s[e+1]=this.mask>>16&255,s[e+2]=this.mask>>8&255,s[e+3]=255&this.mask,s[e+4]=this.platform,s}}class Q extends C{constructor(){super(...arguments),this.versionCode=0,this.sendMtu=p.DEFAULT_PROTOCOL_MTU,this.receiveMtu=p.DEFAULT_PROTOCOL_MTU,this.edrStatus=0,this.edrProfile=0,this.platform=-1,this.volume=0,this.maxVol=0,this.quantity=0,this.functionMask=0,this.curFunction=0,this.btEnable=!1,this.devMusicEnable=!1,this.rtcEnable=!1,this.lineInEanble=!1,this.fmEnable=!1,this.lightEnable=!1,this.fmTXEnable=!1,this.eqEnable=!1,this.supportOfflineShow=!1,this.supportUsb=!0,this.supportSd0=!0,this.supportSd1=!0,this.hideNetRadio=!1,this.sdkType=0,this.pid=0,this.vid=0,this.uid=0,this.mandatoryUpgradeFlag=0,this.requestOtaFlag=0,this.ubootVersionCode=0,this.isSupportDoubleBackup=!1,this.isNeedBootLoader=!1,this.singleBackupOtaWay=0,this.expandMode=0,this.allowConnectFlag=0,this.bleOnly=!1,this.emitterSupport=!1,this.emitterStatus=0,this.isSupportMD5=!1,this.isGameMode=!1,this.isSupportSearchDevice=!1,this.supportVolumeSync=!1,this.supportSoundCard=!1,this.supportExternalFlashTransfer=!1,this.supportAnc=!1,this.banEq=!1,this.supportPackageCrc16=!1,this.getFileByNameWithDev=!1,this.contactsTransferBySmallFile=!1,this.watchSettingMask=0}l(t){let s=super.l(t);if(s<=d.ERROR_NONE)return s;if(t.length<s+2)return d.ERROR_INVALID_PARAM;const e=new Uint8Array(t.length-2);e.set(t.slice(2));let r=0,i=e.length;do{const t=255&e[r];if(r++,t<=0||t>i-r)return n("ResponseTargetInfo: parseData : data len over limit. It is a abnormal data."),d.ERROR_DATA_FORMAT;const s=255&e[r];r++;const a=new Uint8Array(t-1);0!=a.length?(a.set(e.slice(r,r+a.length)),r+=a.length,this.xt(s,a)):n("ResponseTargetInfo: parseData : type = "+s+", data is empty! Skip it.")}while(r+2<=i);return s+r}xt(t,s){switch(n("fillTargetInfo: number:"+t+" value: "+c(s)),t){case 16:this.name=String.fromCharCode.apply(null,Array.from(s));break;case 0:{const t=s[0]>>4&15,e=15&s[0];this.protocolVersion="V"+t+"."+e;break}case 1:this.quantity=255&s[0],s.length>2&&(this.volume=255&s[1],this.maxVol=255&s[2]),s.length>3&&(this.supportVolumeSync=1==(1&s[3]));break;case 10:s.length>=6?(this.vid=(255&s[0])<<8|s[1],this.pid=(255&s[2])<<8|s[3],this.uid=(255&s[4])<<8|s[5]):4==s.length&&(this.vid=1494,this.uid=(255&s[0])<<8|s[1],this.pid=(255&s[2])<<8|s[3]);break;case 2:if(s.length>=6){const t=new Uint8Array(6);t.set(s.slice(0,t.length)),this.edrAddr=o(t)}s.length>=8&&(this.edrProfile=255&s[6],this.edrStatus=255&s[7]);break;case 3:s.length>1&&(this.platform=s[0],this.license=c(s.slice(1)));break;case 4:if(s.length>=5&&(this.functionMask=s[0]<<24|s[1]<<16|s[2]<<8|s[3],this.btEnable=1==(1&this.functionMask),this.devMusicEnable=2==(2&this.functionMask),this.rtcEnable=4==(4&this.functionMask),this.lineInEanble=8==(8&this.functionMask),this.fmEnable=16==(16&this.functionMask),this.lightEnable=32==(32&this.functionMask),this.fmTXEnable=64==(64&this.functionMask),this.eqEnable=128==(128&this.functionMask),this.curFunction=s[4],s.length>5)){const t=s[5];this.supportOfflineShow=1==(1&t),this.supportUsb=2==(2&t),this.supportSd0=4==(4&t),this.supportSd1=8==(8&t),this.hideNetRadio=16==(16&t)}break;case 5:if(s.length>=2){const t=(255&s[0])<<8|s[1],e="V_"+(t>>12&15)+"."+(t>>8&15)+"."+(t>>4&15)+"."+(15&t);this.versionCode=t,this.versionName=e}break;case 6:this.sdkType=s[0],this.supportVolumeSync||(this.supportVolumeSync=2==this.sdkType||4==this.sdkType);break;case 9:this.mandatoryUpgradeFlag=s[0],s.length>=2&&(this.requestOtaFlag=s[1]),s.length>=3&&(this.expandMode=s[2]);break;case 7:if(2==s.length){const t=(255&s[0])<<8|s[1],e="V_"+(t>>12&15)+"."+(t>>8&15)+"."+(t>>4&15)+"."+(15&t);this.ubootVersionCode=t,this.ubootVersionName=e}break;case 8:this.isSupportDoubleBackup=1==(255&s[0]),s.length>=2&&(this.isNeedBootLoader=1==(255&s[1])),s.length>=3&&(this.singleBackupOtaWay=s[2]);break;case 11:this.authKey=String.fromCharCode.apply(null,Array.from(s));break;case 12:this.projectCode=String.fromCharCode.apply(null,Array.from(s));break;case 13:s.length>=4?(this.sendMtu=(255&s[0])<<8|s[1],this.receiveMtu=(255&s[2])<<8|s[3]):2==s.length&&(this.sendMtu=(255&s[0])<<8|s[1],this.receiveMtu=this.sendMtu);break;case 14:this.allowConnectFlag=s[0];break;case 31:this.customVersionMsg=c(s);break;case 17:if(this.bleOnly=1==s[0],s.length>6){const t=new Uint8Array(6);t.set(s.slice(1,1+t.length)),this.bleAddr=o(t)}break;case 18:this.emitterStatus=s[0]>>4&15,this.emitterSupport=1==(15&s[0]);break;case 19:{const t=s[0];this.isSupportMD5=1==(1&t),this.isGameMode=1==(t>>1&1),this.isSupportSearchDevice=1==(t>>2&1),this.supportSoundCard=1==(t>>3&1),this.banEq=1==(t>>4&1),this.supportExternalFlashTransfer=1==(t>>5&1),this.supportAnc=1==(t>>6&1);break}case 20:break;case 21:s.length>=4&&(this.supportPackageCrc16=1==(1&s[0]),this.getFileByNameWithDev=2==(2&s[0]),this.contactsTransferBySmallFile=4==(4&s[0]))}}}class q extends x{constructor(t){super(b.CMD_SETTINGS_COMMUNICATION_MTU,t,new W)}}class J extends D{constructor(){super(...arguments),this.protocolMtu=0}l(t){let s=super.l(t);return s<d.ERROR_NONE?s:t.length<s+2?d.ERROR_DATA_FORMAT:(this.protocolMtu=(255&t[1])<<8|t[0],s+=2,s)}v(){return super.v()}}class W extends C{constructor(){super(...arguments),this.realProtocolMtu=0}l(t){let s=super.l(t);return s<d.ERROR_NONE?s:t.length<s+2?d.ERROR_DATA_FORMAT:(this.realProtocolMtu=(255&t[1])<<8|t[0],s+=2,s)}v(){return super.v()}}class B extends x{constructor(t){super(b.CMD_EXTRA_CUSTOM,t,new C)}}class X extends x{constructor(t){super(b.CMD_CUSTOM,t,new C)}}let K=class{};K.CMD_OTA_GET_DEVICE_UPDATE_FILE_INFO_OFFSET=225,K.CMD_OTA_INQUIRE_DEVICE_IF_CAN_UPDATE=226,K.CMD_OTA_ENTER_UPDATE_MODE=227,K.CMD_OTA_EXIT_UPDATE_MODE=228,K.CMD_OTA_SEND_FIRMWARE_UPDATE_BLOCK=229,K.CMD_OTA_GET_DEVICE_REFRESH_FIRMWARE_STATUS=230,K.CMD_REBOOT_DEVICE=231,K.CMD_OTA_NOTIFY_UPDATE_CONTENT_SIZE=232;let j=class{constructor(){this.cmdParserMap=new Map,this.cmdParserMap.set(K.CMD_OTA_EXIT_UPDATE_MODE,new z),this.cmdParserMap.set(K.CMD_OTA_SEND_FIRMWARE_UPDATE_BLOCK,new Y),this.cmdParserMap.set(K.CMD_OTA_NOTIFY_UPDATE_CONTENT_SIZE,new Z)}lt(){return this.cmdParserMap}};class z extends f{i(){return new tt}}class Y extends f{i(){return new nt(new it)}}class Z extends f{i(){return new st(new et)}}class $ extends C{constructor(){super(...arguments),this.result=m.RESULT_OK}l(t){let s=super.l(t);if(s<d.ERROR_NONE)return s;const e=t.length-s,r=new Uint8Array(e);return r.set(t.slice(s,s+r.length)),s+=r.length,this.result=r[0],s}v(){let t=0;const s=super.v(),e=new Uint8Array(s.byteLength+1);return e.set(s,t),t+=s.length,e[t]=this.result,t+=1,e}}class tt extends x{constructor(){super(K.CMD_OTA_EXIT_UPDATE_MODE,new D,new m)}}class st extends x{constructor(t){super(K.CMD_OTA_NOTIFY_UPDATE_CONTENT_SIZE,t,new C)}}class et extends D{constructor(){super(...arguments),this.totalSize=0,this.currentSize=0}l(t){let s=super.l(t);return s<d.ERROR_NONE?s:t.length<s+4?d.ERROR_DATA_FORMAT:(this.totalSize=t[s+0]<<24|t[s+1]<<16|t[s+2]<<8|t[s+3],s+=4,t.length>=s+4&&(this.currentSize=t[s+0]<<24|t[s+1]<<16|t[s+2]<<8|t[s+3],s+=4),s)}v(){const t=super.v();let s;s=this.currentSize>0?t.length+8:t.length+4;const e=new Uint8Array(s);let r=0;return e.set(t,r),r+=t.length,e[r]=this.totalSize>>24,e[r+1]=this.totalSize>>16&255,e[r+2]=this.totalSize>>8&255,e[r+3]=255&this.totalSize,r+=4,this.currentSize>0&&(e[r]=this.totalSize>>24,e[r+1]=this.totalSize>>16&255,e[r+2]=this.totalSize>>8&255,e[r+3]=255&this.totalSize,r+=4),e}}class rt extends x{constructor(){super(K.CMD_OTA_GET_DEVICE_REFRESH_FIRMWARE_STATUS,new D,new m)}}rt.UPGRADE_RESULT_COMPLETE=0,rt.UPGRADE_RESULT_DATA_CHECK_ERROR=1,rt.UPGRADE_RESULT_FAIL=2,rt.UPGRADE_RESULT_ENCRYPTED_KEY_NOT_MATCH=3,rt.UPGRADE_RESULT_UPGRADE_FILE_ERROR=4,rt.UPGRADE_RESULT_UPGRADE_TYPE_ERROR=5,rt.UPGRADE_RESULT_ERROR_LENGTH=6,rt.UPGRADE_RESULT_FLASH_READ=7,rt.UPGRADE_RESULT_CMD_TIMEOUT=8,rt.UPGRADE_RESULT_DOWNLOAD_BOOT_LOADER_SUCCESS=128;class nt extends x{constructor(t){super(K.CMD_OTA_SEND_FIRMWARE_UPDATE_BLOCK,t,new at)}}class it extends D{constructor(){super(...arguments),this.offset=0,this.len=0}v(){const t=super.v(),s=new Uint8Array(t.length+6);let e=0;return s.set(t,e),e+=t.length,s[e]=this.offset>>24,s[e+1]=this.offset>>16&255,s[e+2]=this.offset>>8&255,s[e+3]=255&this.offset,e+=4,s[e]=this.len>>8&255,s[e+1]=255&this.len,e+=2,s}l(t){let s=super.l(t);return s<d.ERROR_NONE?s:t.length<s+4+2?d.ERROR_DATA_FORMAT:(this.offset=t[s+0]<<24|t[s+1]<<16|t[s+2]<<8|t[s+3],s+=4,this.len=t[s+0]<<8|t[s+1],s+=2,s)}}class at extends C{v(){const t=super.v();if(null!=this.block&&this.block.length>0){const s=new Uint8Array(t.length+this.block.length);let e=0;return s.set(t,e),e+=t.length,s.set(this.block,e),e+=this.block.length,s}return t}l(t){let s=super.l(t);if(s<d.ERROR_NONE)return s;const e=t.length-s;if(0==e)return this.block=new Uint8Array(1),this.block[0]=0,s;const r=new Uint8Array(e);return r.set(t.slice(s,s+r.length)),s+=r.length,this.block=r,s}}class ht extends C{constructor(){super(...arguments),this.offset=0,this.len=0}v(){const t=super.v(),s=new Uint8Array(t.length+6);let e=0;return s.set(t,e),e+=t.length,s[e]=this.offset>>24,s[e+1]=this.offset>>16&255,s[e+2]=this.offset>>8&255,s[e+3]=255&this.offset,e+=4,s[e]=this.len>>8&255,s[e+1]=255&this.len,e+=2,s}l(t){let s=super.l(t);return s<d.ERROR_NONE?s:t.length<s+4+2?d.ERROR_DATA_FORMAT:(this.offset=t[s+0]<<24|t[s+1]<<16|t[s+2]<<8|t[s+3],s+=4,this.len=t[s+0]<<8|t[s+1],s+=2,s)}}class ct extends D{constructor(t){super(),this.op=t}v(){const t=super.v(),s=new Uint8Array(t.length+1);let e=0;return s.set(t,e),e+=t.length,s[e]=255&this.op,e+=1,s}}ct.OP_REBOOT=0,ct.OP_CLOSE=1;class ot extends x{constructor(t){super(K.CMD_OTA_INQUIRE_DEVICE_IF_CAN_UPDATE,t,new m)}}ot.RESULT_CAN_UPDATE=0,ot.RESULT_DEVICE_LOW_VOLTAGE_EQUIPMENT=1,ot.RESULT_FIRMWARE_INFO_ERROR=2,ot.RESULT_FIRMWARE_VERSION_NO_CHANGE=3,ot.RESULT_TWS_NOT_CONNECT=4,ot.RESULT_HEADSET_NOT_IN_CHARGING_BIN=5;class lt{}lt.CMD_ADV_SETTINGS=192,lt.CMD_ADV_GET_INFO=193,lt.CMD_ADV_DEVICE_NOTIFY=194,lt.CMD_ADV_NOTIFY_SETTINGS=195,lt.CMD_ADV_DEV_REQUEST_OPERATION=196;class ut{constructor(){this.ot=new Map,this.ot.set(lt.CMD_ADV_DEVICE_NOTIFY,new dt),this.ot.set(lt.CMD_ADV_DEV_REQUEST_OPERATION,new pt)}lt(){return this.ot}}class pt extends f{i(){return new gt}}class dt extends f{i(){return new Dt}}class ft{constructor(){this.keyNum=0,this.action=0,this.function=0}v(){const t=new Uint8Array(3);return t[0]=255&this.keyNum,t[1]=255&this.action,t[2]=255&this.function,t}}class wt{constructor(){this.scene=0,this.effect=0}v(){const t=new Uint8Array(2);return t[0]=255&this.scene,t[1]=255&this.effect,t}}class xt extends C{constructor(){super(...arguments),this.pid=0,this.vid=0,this.uid=0,this.leftDeviceQuantity=0,this.isLeftCharging=!1,this.rightDeviceQuantity=0,this.isRightCharging=!1,this.chargingBinQuantity=0,this.isDeviceCharging=!1,this.micChannel=0,this.workModel=0,this.inEarSettings=0}l(t){let s=super.l(t);if(s<d.ERROR_NONE)return s;const e=t;if(null!=e&&e.length>0){let t=s;const r=e.length;for(;t+2<=r;){const s=e[t];if(!(s>0))return h("parseADVInfo :: data length"+s+" over MAX_COMMUNICATION_MTU, cast away"),d.ERROR_DATA_FORMAT;{const n=e[t+1];let i=new Uint8Array(s-1);if(!(i.length>0&&i.length+t+2<=r)){if(0==i.length){t+=2;continue}return d.ERROR_DATA_FORMAT}switch(i=e.slice(t+2,t+2+i.length),t+=2+i.length,n){case 0:{const t=i[0]>>7&1,s=127&i[0];if(this.isLeftCharging=1==t,this.leftDeviceQuantity=s,i.length>=2){const t=i[1]>>7&1,s=127&i[1];if(this.isRightCharging=1==t,this.rightDeviceQuantity=s,i.length>=3){const t=i[2]>>7&1,s=127&i[2];this.isDeviceCharging=1==t,this.chargingBinQuantity=s}}continue}case 1:this.deviceName=l(i);continue;case 2:{let t;if(null!=i&&i.length>=3){let s=0,e=new Uint8Array(3);for(;s<i.length&&s+3<=i.length;){e=i.slice(s,s+3),s+=e.length;const r=new ft;r.keyNum=e[0],r.action=e[1],r.function=e[2],null==t&&(t=new Array),t.push(r)}}this.keySettingsList=t;continue}case 3:{let t;if(null!=i&&i.length>=2){let s=0;for(;s<i.length;){let e=i.slice(s,s+2);s+=2;const r=new wt;r.scene=e[0],r.effect=e[1],null==t&&(t=new Array),t.push(r)}}this.ledSettingsList=t;continue}case 4:this.micChannel=i[0];continue;case 5:this.workModel=i[0];continue;case 6:i.length>=6&&(this.vid=((255&i[0])<<8)+(255&i[1]),this.uid=((255&i[2])<<8)+(255&i[3]),this.pid=((255&i[4])<<8)+(255&i[5]));continue;case 8:this.inEarSettings=i[0];continue;case 9:this.language=l(i);continue;case 10:if(i.length>=4){const t=(255&i[0])<<24|(255&i[1])<<16|(255&i[2])<<8|255&i[3],s=new Array;for(let e=0;e<32;e++){1==(t>>e&1)&&s.push(e)}if(0!=s.length){let t=new Uint8Array(s.length);for(let e=0;e<s.length;e++){const r=s[e];null!=r&&(t[e]=r)}this.modes=t}}continue;default:a("-parseADVInfo- unknown type = "+n)}}}}return s=t.length,s}}class Dt extends x{constructor(){super(lt.CMD_ADV_DEVICE_NOTIFY,new Ct,null)}}class Ct extends D{constructor(){super(...arguments),this.vid=0,this.pid=0,this.uid=0,this.deviceType=0,this.version=0,this.showDialog=!1,this.edrAddr="",this.seq=0,this.action=0,this.leftDeviceQuantity=0,this.leftCharging=!1,this.rightDeviceQuantity=0,this.rightCharging=!1,this.chargingBinQuantity=0,this.deviceCharging=!1}getVid(){return this.vid}setVid(t){return this.vid=t,this}getPid(){return this.pid}setPid(t){return this.pid=t,this}getUid(){return this.uid}setUid(t){return this.uid=t,this}getDeviceType(){return this.deviceType}setDeviceType(t){return this.deviceType=t,this}getVersion(){return this.version}setVersion(t){return this.version=t,this}isShowDialog(){return this.showDialog}setShowDialog(t){return this.showDialog=t,this}getEdrAddr(){return this.edrAddr}setEdrAddr(t){return this.edrAddr=t,this}getSeq(){return this.seq}setSeq(t){return this.seq=t,this}getAction(){return this.action}setAction(t){return this.action=t,this}getLeftDeviceQuantity(){return this.leftDeviceQuantity}setLeftDeviceQuantity(t){return this.leftDeviceQuantity=t,this}isLeftCharging(){return this.leftCharging}setLeftCharging(t){return this.leftCharging=t,this}getRightDeviceQuantity(){return this.rightDeviceQuantity}setRightDeviceQuantity(t){return this.rightDeviceQuantity=t,this}isRightCharging(){return this.rightCharging}setRightCharging(t){return this.rightCharging=t,this}getChargingBinQuantity(){return this.chargingBinQuantity}setChargingBinQuantity(t){return this.chargingBinQuantity=t,this}isDeviceCharging(){return this.deviceCharging}setDeviceCharging(t){return this.deviceCharging=t,this}l(t){let s=super.l(t);if(s<d.ERROR_NONE)return s;if(t.length<s+18)return d.ERROR_DATA_FORMAT;const e=new Uint8Array(18);return e.set(t.slice(s,s+18)),s+=18,this.Dt(e),s}Dt(t){this.setVid((t[0]<<8)+t[1]).setUid((t[2]<<8)+t[3]).setPid((t[4]<<8)+t[5]),this.setDeviceType(t[6]>>4&255).setVersion(15&t[6]);const s=new Uint8Array(6);s.set(t.slice(7,7+s.length)),this.setEdrAddr(o(s)).setAction(t[13]),this.setLeftCharging(1==(t[14]>>7&1)).setLeftDeviceQuantity(127&t[14]),this.setRightCharging(1==(t[15]>>7&1)).setRightDeviceQuantity(127&t[15]),this.setDeviceCharging(1==(t[16]>>7&1)).setChargingBinQuantity(127&t[16]),this.setSeq(t[17])}}class mt extends D{constructor(t){super(),this.op=-1,null!=t&&(this.op=t)}v(){const t=super.v(),s=new Uint8Array(t.length+1);let e=0;return s.set(t,e),e+=t.length,s[e]=this.op,s}l(t){let s=super.l(t);return s<d.ERROR_NONE?s:t.length<s+1?d.ERROR_DATA_FORMAT:(this.op=255&t[s],s++,s)}}class yt extends x{constructor(t){super(lt.CMD_ADV_NOTIFY_SETTINGS,new mt(t),new m)}}yt.CTRL_OP_CLOSE=0,yt.CTRL_OP_OPEN=1;class gt extends x{constructor(){super(lt.CMD_ADV_DEV_REQUEST_OPERATION,new mt,new C)}}gt.REQUEST_OP_SYNC_SETTINGS=0,gt.REQUEST_OP_UPDATE_SETTINGS_AND_REBOOT=1,gt.REQUEST_OP_SYNC_CONNECTION_TIME=2,gt.REQUEST_OP_RECONNECT_DEVICE=3,gt.REQUEST_OP_SYNC_DEVICE_INFO=4;class At extends U{constructor(){super(...arguments),this.deviceInfoMap=new Map}release(){this.deviceInfoMap.clear()}getReceiveMtu(t){const s=this.getDeviceInfo(t);return null!=s&&s.receiveMtu>0?s.receiveMtu:null}getSendMtu(t){const s=this.getDeviceInfo(t);return null!=s&&s.sendMtu>0?s.sendMtu:null}getDeviceInfo(t){return this.deviceInfoMap.get(t.deviceId)}removeDeviceInfo(t){if(0!=this.deviceInfoMap.size)return this.deviceInfoMap.delete(t.deviceId)}updateDeviceInfo(t,s){this.deviceInfoMap.set(t.deviceId,s)}}class vt{onRcspInit(t,s){}onRcspCommand(t,s){}onRcspResponse(t,s){}onRcspDataCmd(t,s){}onRcspError(t,s,e){}onMandatoryUpgrade(t){}onConnectStateChange(t,s){}}class Rt{constructor(){this.cmdSn=0,this.cmdSnMap=new Map,this.cmdSn=parseInt(256*Math.random()+"")}getRcspCmdSeq(t){return this.autoIncSN(t)}autoIncSN(t){const s=this.getCmdSn(t),e=(s+1)%256;return null==t?this.cmdSn=e:this.cmdSnMap.set(t.deviceId,e),s}resetCmdSeq(t){null==t?this.cmdSn=0:this.cmdSnMap.delete(t.deviceId)}release(){this.cmdSn=0,this.cmdSnMap.clear()}getCmdSn(t){if(null==t)return this.cmdSn;let s=this.cmdSnMap.get(t.deviceId);return null==s?this.cmdSn:s}}class kt extends vt{constructor(){super(...arguments),this.Ct=new Array}registerRcspCallback(t){null!=t&&this.Ct.push(t)}unregisterRcspCallback(t){if(null!=t){var s=this.Ct.indexOf(t);-1!=s&&this.Ct.splice(s,1)}}release(){this.Ct.length=0}onRcspInit(t,s){this.yt({onCallback:e=>{e.onRcspInit(t,s)}})}onRcspCommand(t,s){this.yt({onCallback:e=>{e.onRcspCommand(t,s)}})}onRcspResponse(t,s){this.yt({onCallback:e=>{e.onRcspResponse(t,s)}})}onRcspDataCmd(t,s){this.yt({onCallback:e=>{e.onRcspDataCmd(t,s)}})}onRcspError(t,s,e){this.yt({onCallback:r=>{r.onRcspError(t,s,e)}})}onMandatoryUpgrade(t){this.yt({onCallback:s=>{s.onMandatoryUpgrade(t)}})}onConnectStateChange(t,s){this.yt({onCallback:e=>{e.onConnectStateChange(t,s)}})}yt(t){0!=this.Ct.length&&this.Ct.forEach((s=>{t.onCallback(s)}))}}class Ut{constructor(){this.mTargetDevice=null,this.mCmdSnGenerator=new Rt,this.mRcspCallbackManager=new kt,this.mDeviceInfoManager=new At;const t={onRcspCommand:(t,s)=>{this.gt(t,s)},onRcspResponse:(t,s)=>{this.At(t,s)},onError:(t,s,e)=>{this.mRcspCallbackManager.onRcspError(t,s,e)}};this.mRCSPDataHandler=new R(this,this.mDeviceInfoManager,this.getNotifyCmdParser(),t)}getUsingDevice(){return this.mTargetDevice}setOnSendDataCallback(t){this.mOnSendDataCallback=t}isDeviceConnected(){return null!=this.getUsingDevice()&&null!=this.getDeviceInfo(this.getUsingDevice())}getDeviceInfo(t){return this.mDeviceInfoManager.getDeviceInfo(t)}addOnRcspCallback(t){this.mRcspCallbackManager.registerRcspCallback(t)}removeOnRcspCallback(t){this.mRcspCallbackManager.unregisterRcspCallback(t)}transmitDeviceStatus(t,s){this.mRcspCallbackManager.onConnectStateChange(t,s),this.vt(t,s)}transmitDeviceData(t,s){this.Rt(t,s)}sendDataToDevice(t,s){return null==this.mOnSendDataCallback?(h("RcspImpl: OnSendDataCallback is null,so sendDataToDevice failed"),!1):this.mOnSendDataCallback.sendDataToDevice(t,s)}sendRCSPCommand(t,s,e,r){if(!this.kt(t,r))return;if(null==s){const s=d.ERROR_INVALID_PARAM;return void this.Ut(r,t,s,d.getErrorDesc2(s,"Command is null."))}s.isCommand()&&s.setSn(this.mCmdSnGenerator.getRcspCmdSeq(t));const n=new g(t,s,e,r);this.mRCSPDataHandler.W(n)}syncDeviceInfo(t,s,e){const r=new G(s);this.bt(t,r,{onCmdResponse(t,s){if(s.getStatus()!=C.STATUS_SUCCESS){const e=d.ERROR_REPLY_BAD_STATUS;return void this.onError(t,e,d.getErrorDesc2(e,""+s.getStatus()))}const r=s.getResponse();if(null!=r)n("RcspOpImpl: syncDeviceInfo : "+s),null!=e&&e.onResult(t,r);else{const s=d.ERROR_DATA_FORMAT;this.onError(t,s,d.getErrorDesc2(s,"Get targetInfo is null."))}},onError(t,s,r){null!=e&&e.onError(t,s,r)}})}destroy(){this.mCmdSnGenerator.release(),this.mRcspCallbackManager.release(),this.mTargetDevice=null,this.mRCSPDataHandler.destroy()}getDeviceInfoManager(){return this.mDeviceInfoManager}Ut(t,s,e,r){null!=t&&t.onError(s,e,d.getErrorDesc2(e,r))}$(t,s,e){const r=d.getErrorDesc2(s,e);h("RcspOpImpl: callbackError : device["+t+"] has an exception: "+u(s)+", "+r),this.mRCSPDataHandler.listener.onError(t,s,r)}bt(t,s,e){this.sendRCSPCommand(t,s,p.DEFAULT_SEND_CMD_TIMEOUT,e)}vt(t,s){if(null!=s)switch(s){case exports.Connection.CONNECTION_DISCONNECT:t.equals(this.mTargetDevice)&&(this.mTargetDevice=null,this.getDeviceInfoManager().removeDeviceInfo(t),this.mRCSPDataHandler.J());break;case exports.Connection.CONNECTION_CONNECTED:if(null!=this.mTargetDevice){const s="Device is Connected. device : "+t+", connected Device : "+this.mTargetDevice;return n("RcspOpImpl: "+s),void this.$(t,d.ERROR_REPEAT_STATUS,s)}this.mTargetDevice=t,this.mRCSPDataHandler.L(),this.St(t)}}St(t){const s=this.getDeviceInfo(t);if(n("RcspOpImpl: handleDeviceConnectedEvent : "+JSON.stringify(s)),null==s){const s=new L(4294967295,2),e=this;this.syncDeviceInfo(t,s,{onResult(t,s){e.getDeviceInfoManager().updateDeviceInfo(t,s),n("RcspOpImpl: handleDeviceConnectedEvent : onResult ===> "+JSON.stringify(s)),e.St(t)},onError(t,s,r){e.mRcspCallbackManager.onRcspInit(t,!1),h("RcspOpImpl:  Init RCSP protocol failed. so callback the device is disconnected.\ncode = "+s+", "+r),e.vt(t,exports.Connection.CONNECTION_DISCONNECT)}})}else s.mandatoryUpgradeFlag?(s.receiveMtu<p.DEFAULT_PROTOCOL_MTU&&(s.receiveMtu=p.DEFAULT_PROTOCOL_MTU),this.getDeviceInfoManager().updateDeviceInfo(t,s),n("RcspOpImpl: handleDeviceConnectedEvent : device["+JSON.stringify(t)+"] need update."),this.mRcspCallbackManager.onRcspInit(t,!0),this.mRcspCallbackManager.onMandatoryUpgrade(t)):(n("RcspOpImpl: handleDeviceConnectedEvent : init success."),this.mRcspCallbackManager.onRcspInit(t,!0))}kt(t,s){return!!t.equals(this.mTargetDevice)||(null!=s?this.Ut(s,t,d.ERROR_DEVICE_OFFLINE,""):this.$(t,d.ERROR_DEVICE_OFFLINE,""),!1)}Rt(t,s){null!=t&&null!=s&&0!=s.length&&this.kt(t,null)&&this.mRCSPDataHandler.K(new A(t,s))}gt(t,s){if(this.kt(t,null))if(s.getOpCode()==b.CMD_DATA)this.mRcspCallbackManager.onRcspDataCmd(t,s);else switch(this.mRcspCallbackManager.onRcspCommand(t,s),s.getOpCode()){case b.CMD_DATA:this.mRcspCallbackManager.onRcspDataCmd(t,s);break;case b.CMD_SETTINGS_COMMUNICATION_MTU:const e=s,r=e.getParam().protocolMtu,n=this.getDeviceInfo(t);if(null!=n&&(n.receiveMtu=r,this.getDeviceInfoManager().updateDeviceInfo(t,n)),e.isNeedResponse()){const n=e.getResponse();null!=n&&(n.setSn(s.getSn()),n.setStatus(C.STATUS_SUCCESS),n.realProtocolMtu=r),e.setCommand(!1),this.bt(t,e,null)}case b.CMD_SYS_INFO_AUTO_UPDATE:}}At(t,s){if(this.kt(t,null)&&s.getStatus()==C.STATUS_SUCCESS&&(this.mRcspCallbackManager.onRcspResponse(t,s),s.getOpCode()===b.CMD_SETTINGS_COMMUNICATION_MTU)){const e=s.getResponse().realProtocolMtu,r=this.getDeviceInfo(t);null!=r&&(r.receiveMtu=e,this.getDeviceInfoManager().updateDeviceInfo(t,r))}}}class bt{static getErrorDesc(t){switch(t){case bt.ERR_NONE:return"Success";case bt.ERR_INVALID_PARAMETER:return"Invalid Parameter.";case bt.ERR_CANCEL_OP:return"Cancel Operation.";case bt.ERR_OPERATION_TIMEOUT:return"Operation timeout.";case bt.ERR_REMOTE_NOT_CONNECT:return"The remote device is not connected.";case bt.ERR_DEVICE_NOT_MATCH:return"The device is not the same as the device in use.";case bt.ERR_USE_SYSTEM_API:return"Failed to use system reflection function.";case bt.ERR_AUTH_DEVICE:return"Failed to auth device.";case bt.ERR_CMD_SEND:return"Command sending failed.";case bt.ERR_PARSE_DATA:return"Failed to parse RCSP data.";case bt.ERR_RESPONSE_TIMEOUT:return"Waiting for a reply packet timed out.";case bt.ERR_SYSTEM_BUSY:return"System is busy.";case bt.ERR_RESPONSE_BAD_STATUS:return"Device returns a failed state.";case bt.ERR_RESPONSE_BAD_RESULT:return"Device returns a failure result.";case bt.ERR_STORAGE_OFFLINE:return"Storage offline.";case bt.ERR_FILE_BROWSING:return"File browsing.";case bt.ERR_DATA_LOAD_COMPLETE:return"File data is loaded.";case bt.ERR_MISSING_FILE_DATA:return"Missing file data.";case bt.ERR_DIR_TOO_DEEP:return"Directory hierarchy is too deep.";case bt.ERR_IO_EXCEPTION:return"IO Exception.";case bt.ERR_FILE_NOT_IN_STORAGE:return"File does not match storage";default:return"Unknown Code : "+t}}}bt.ERR_NONE=0,bt.ERR_INVALID_PARAMETER=4097,bt.ERR_CANCEL_OP=4098,bt.ERR_OPERATION_TIMEOUT=4099,bt.ERR_OTHER=4100,bt.ERR_REMOTE_NOT_CONNECT=8192,bt.ERR_DEVICE_NOT_MATCH=8193,bt.ERR_USE_SYSTEM_API=8194,bt.ERR_AUTH_DEVICE=8195,bt.ERR_CMD_SEND=12288,bt.ERR_PARSE_DATA=12289,bt.ERR_RESPONSE_TIMEOUT=12290,bt.ERR_SYSTEM_BUSY=12291,bt.ERR_RESPONSE_BAD_STATUS=12292,bt.ERR_RESPONSE_BAD_RESULT=12293,bt.ERR_STORAGE_OFFLINE=16384,bt.ERR_FILE_BROWSING=16385,bt.ERR_DATA_LOAD_COMPLETE=16386,bt.ERR_MISSING_FILE_DATA=16387,bt.ERR_DIR_TOO_DEEP=16388,bt.ERR_IO_EXCEPTION=16389,bt.ERR_FILE_NOT_IN_STORAGE=16390;exports.CmdChangeCommunicationWay=class extends x{constructor(t){super(b.CMD_SWITCH_DEVICE_REQUEST,t,new m)}},exports.CmdControlADVStream=yt,exports.CmdCustom=B,exports.CmdData=T,exports.CmdDeviceRequestOp=gt,exports.CmdEnterUpdateMode=class extends x{constructor(){super(K.CMD_OTA_ENTER_UPDATE_MODE,new D,new $)}},exports.CmdExitUpdateMode=tt,exports.CmdGetADVInfo=class extends x{constructor(t){super(lt.CMD_ADV_GET_INFO,t,new xt)}},exports.CmdGetSysInfo=class extends x{constructor(t){super(b.CMD_GET_SYS_INFO,t,new F)}},exports.CmdGetTargetInfo=G,exports.CmdInnerCustom=X,exports.CmdNotifyADVInfo=Dt,exports.CmdNotifySysInfo=N,exports.CmdNotifyUpdateFileSize=st,exports.CmdOpCodeBase=b,exports.CmdOpCodeHeadSet=lt,exports.CmdOpCodeOta=K,exports.CmdQueryUpdateResult=rt,exports.CmdReadFileBlock=nt,exports.CmdReadFileOffset=class extends x{constructor(){super(K.CMD_OTA_GET_DEVICE_UPDATE_FILE_INFO_OFFSET,new D,new ht)}},exports.CmdRebootDevice=class extends x{constructor(t){super(K.CMD_REBOOT_DEVICE,t,new m)}},exports.CmdRequestUpdate=ot,exports.CmdSetADVInfo=class extends x{constructor(t){super(lt.CMD_ADV_SETTINGS,t,new m)}},exports.CmdSetMtu=q,exports.CmdSetSysInfo=class extends x{constructor(t){super(b.CMD_SET_SYS_INFO,t,new C)}},exports.Command=x,exports.CommandBase=class extends x{},exports.Device=class{constructor(t,s){this.deviceId=t,s&&(this.name=s)}equals(t){return null!=t&&(this==t||this.deviceId==t.deviceId)}},exports.DeviceInfo=class extends Q{},exports.DeviceInfoManager=At,exports.ErrorCode=d,exports.KeySettings=ft,exports.LedSettings=wt,exports.LtvBean=V,exports.OnRcspCallback=vt,exports.ParamADVInfo=Ct,exports.ParamBase=D,exports.ParamCommunicationWay=class extends D{constructor(t,s){super(),this.isSupportNewRebootWay=!1,this.communicationWay=t,s&&(this.isSupportNewRebootWay=s)}v(){const t=super.v(),s=new Uint8Array(t.length+2);let e=0;return s.set(t,e),e+=t.length,s[e]=this.communicationWay,s[e+1]=this.isSupportNewRebootWay?1:0,s}},exports.ParamData=M,exports.ParamFileBlock=it,exports.ParamGetADVInfo=class extends D{constructor(t){super(),this.mask=t}v(){const t=super.v(),s=new Uint8Array(t.length+4);let e=0;return s.set(t,e),e+=t.length,s[e]=this.mask>>24&255,s[e+1]=this.mask>>16&255,s[e+2]=this.mask>>8&255,s[e+3]=255&this.mask,e+=4,s}l(t){let s=super.l(t);return s<d.ERROR_NONE?s:t.length<s+4?d.ERROR_DATA_FORMAT:(this.mask=t[s]<<24|t[s+1]<<16|t[s+2]<<8|t[s+3],s+=4,s)}},exports.ParamGetSysInfo=class extends D{constructor(){super(...arguments),this.function=0,this.mask=0}v(){let t=0;const s=super.v(),e=new Uint8Array(s.byteLength+5);e.set(s),t+=s.length,e[t]=null==this.function?0:this.function,t++;const r=null==this.mask?0:this.mask;return e[t]=r>>24,e[t+1]=r>>16&255,e[t+2]=r>>8&255,e[t+3]=255&r,e}},exports.ParamMtu=J,exports.ParamOperation=mt,exports.ParamRebootDevice=ct,exports.ParamRequestUpdate=class extends D{constructor(t){super(),this.data=t}v(){const t=super.v();if(null!=this.data&&this.data.length>0){const s=new Uint8Array(t.length+this.data.length);let e=0;return s.set(t,e),e+=t.length,s.set(this.data,e),e+=1,s}return t}},exports.ParamSetADVInfo=class extends D{constructor(t){super(),this.payload=t}v(){const t=super.v(),s=new Uint8Array(t.length+this.payload.length);let e=0;return s.set(t,e),e+=t.length,s.set(this.payload,e),s}l(t){let s=super.l(t);return s<d.ERROR_NONE?s:t.length<s?d.ERROR_DATA_FORMAT:(this.payload=t.slice(s),s=t.length,s)}},exports.ParamSysInfo=H,exports.ParamTargetInfo=L,exports.ParamUpdateFileSize=et,exports.RCSPError=class{constructor(t,s){this.errorCode=t,this.message=null==s?bt.getErrorDesc(t):s}},exports.RCSPErrorCode=bt,exports.RcspCallbackManager=kt,exports.RcspConstant=p,exports.RcspImpl=class extends Ut{getNotifyCmdParser(){const t=new Map,s=(new S).lt();for(const e of s)t.set(e[0],e[1]);const e=(new j).lt();for(const s of e)t.set(s[0],s[1]);const r=(new ut).lt();for(const s of r)t.set(s[0],s[1]);return t}},exports.ResponseBase=C,exports.ResponseData=class extends C{v(){let t=0;const s=super.v(),e=new Uint8Array(s.byteLength+1);return e.set(s,t),t+=s.length,null!=this.responseOpCode&&(e[t]=this.responseOpCode,t+=1),e}l(t){let s=super.l(t);return s<d.ERROR_NONE?s:t.length<s+1?d.ERROR_DATA_FORMAT:(this.responseOpCode=255&t[s],s++,s)}},exports.ResponseFileBlock=at,exports.ResponseFileOffset=ht,exports.ResponseGetADVInfo=xt,exports.ResponseMtu=W,exports.ResponseResult=m,exports.ResponseSysInfo=F,exports.ResponseTargetInfo=Q,exports.ab2hex=c,exports.bigBytes2ToInt=function(t){return t[0]<<8|t[1]},exports.bigBytes4ToInt=function(t){return t[0]<<24|t[1]<<16|t[2]<<8|t[3]},exports.gbkToString=function(t){const s=Array.from(new Uint16Array(t));return decodeURIComponent(escape(String.fromCharCode(...s)))},exports.hexDataCovetToAddress=o,exports.intToBigBytes2=function(t){const s=new Uint8Array(2);return s[1]=255&t,s[0]=t>>8&255,s},exports.intToBigBytes4=function(t){const s=new Uint8Array(4);return s[3]=255&t,s[2]=t>>8&255,s[1]=t>>16&255,s[0]=t>>24&255,s},exports.logd=function(...e){r<=2&&null!=s&&s.logd(t,...e)},exports.loge=h,exports.logi=i,exports.logv=n,exports.logw=a,exports.setLogGrade=function(t){r=t},exports.setLogger=function(t){s=t},exports.toHexWithPrefix=u,exports.utf8ToString=l;
